<!--
=============================================================================
FORM.HTML - Formulário de Criação/Edição de Tarefas
=============================================================================

Template reutilizável para criar e editar tarefas.
A mesma página serve para ambas as ações, mudando apenas o título.

DEMONSTRA:
- Renderização de formulários Django
- Token CSRF para segurança
- Exibição de erros de validação
-->

{% extends 'base.html' %}

{% block title %}{{ acao }} Tarefa{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <!-- 
                    'acao' vem do contexto da view: 'Criar' ou 'Editar'
                    -->
                    {% if acao == 'Criar' %}
                        <i class="bi bi-plus-circle"></i>
                    {% else %}
                        <i class="bi bi-pencil"></i>
                    {% endif %}
                    {{ acao }} Tarefa
                </h4>
            </div>
            
            <div class="card-body">
                <!-- 
                =============================================================
                FORMULÁRIO
                =============================================================
                
                method="POST": envia dados para o servidor
                (GET apenas adiciona parâmetros na URL)
                
                action: para onde enviar (vazio = mesma URL)
                
                enctype="multipart/form-data": necessário para upload de arquivos
                -->
                <form method="POST" action="">
                    <!-- 
                    {% csrf_token %}
                    OBRIGATÓRIO para formulários POST no Django!
                    
                    CSRF = Cross-Site Request Forgery
                    É um tipo de ataque onde um site malicioso tenta enviar
                    requisições em nome do usuário logado.
                    
                    O token CSRF garante que a requisição veio do próprio site.
                    Se você esquecer, receberá erro 403 Forbidden!
                    -->
                    {% csrf_token %}
                    
                    <!-- 
                    =============================================================
                    EXIBIÇÃO DE ERROS GERAIS
                    =============================================================
                    Erros que não estão associados a um campo específico
                    (validados no método clean() do formulário)
                    -->
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                <p class="mb-0">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <!-- 
                    =============================================================
                    CAMPOS DO FORMULÁRIO
                    =============================================================
                    Existem várias formas de renderizar formulários:
                    
                    1. Automático (simples, mas menos controle):
                       {{ form.as_p }}   → cada campo em <p>
                       {{ form.as_table }} → cada campo em <tr>
                       {{ form.as_ul }}  → cada campo em <li>
                       {{ form.as_div }} → cada campo em <div> (Django 4.0+)
                    
                    2. Manual (mais controle):
                       {{ form.campo }}       → apenas o input
                       {{ form.campo.label }} → apenas o label
                       {{ form.campo.errors }} → apenas os erros
                       {{ form.campo.help_text }} → texto de ajuda
                    
                    Aqui usamos o método manual para controle total do layout.
                    -->
                    
                    <!-- Campo: Título -->
                    <div class="mb-3">
                        <label for="{{ form.titulo.id_for_label }}" class="form-label">
                            {{ form.titulo.label }}
                            <!-- Asterisco para campos obrigatórios -->
                            {% if form.titulo.field.required %}
                                <span class="text-danger">*</span>
                            {% endif %}
                        </label>
                        <!-- 
                        O widget já foi configurado no forms.py com as classes CSS
                        form.titulo renderiza apenas o <input>
                        -->
                        {{ form.titulo }}
                        
                        <!-- Texto de ajuda -->
                        {% if form.titulo.help_text %}
                            <small class="form-text text-muted">
                                {{ form.titulo.help_text }}
                            </small>
                        {% endif %}
                        
                        <!-- Erros do campo -->
                        {% if form.titulo.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.titulo.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Campo: Descrição -->
                    <div class="mb-3">
                        <label for="{{ form.descricao.id_for_label }}" class="form-label">
                            {{ form.descricao.label }}
                        </label>
                        {{ form.descricao }}
                        {% if form.descricao.help_text %}
                            <small class="form-text text-muted">
                                {{ form.descricao.help_text }}
                            </small>
                        {% endif %}
                        {% if form.descricao.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.descricao.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Campos em linha: Prioridade e Categoria -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.prioridade.id_for_label }}" class="form-label">
                                {{ form.prioridade.label }}
                            </label>
                            {{ form.prioridade }}
                            {% if form.prioridade.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.prioridade.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.categoria.id_for_label }}" class="form-label">
                                {{ form.categoria.label }}
                            </label>
                            {{ form.categoria }}
                            {% if form.categoria.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.categoria.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Campo: Data Limite -->
                    <div class="mb-3">
                        <label for="{{ form.data_limite.id_for_label }}" class="form-label">
                            {{ form.data_limite.label }}
                        </label>
                        {{ form.data_limite }}
                        {% if form.data_limite.help_text %}
                            <small class="form-text text-muted">
                                {{ form.data_limite.help_text }}
                            </small>
                        {% endif %}
                        {% if form.data_limite.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.data_limite.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- 
                    =============================================================
                    BOTÕES
                    =============================================================
                    -->
                    <hr>
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'lista_tarefas' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check"></i> 
                            {% if acao == 'Criar' %}
                                Criar Tarefa
                            {% else %}
                                Salvar Alterações
                            {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- 
        =============================================================
        DICA SOBRE FORMULÁRIOS
        =============================================================
        -->
        <div class="card mt-3 border-info">
            <div class="card-body text-info">
                <h6><i class="bi bi-info-circle"></i> Dica sobre Formulários Django</h6>
                <small>
                    Este formulário foi criado usando <code>ModelForm</code> no arquivo 
                    <code>forms.py</code>. O Django gera automaticamente os campos 
                    baseado no model, incluindo validações!
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}
